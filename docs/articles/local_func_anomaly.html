<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="LCZ4r">
<title>Thermal Anomalies • LCZ4r</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Montserrat-0.4.9/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Thermal Anomalies">
<meta property="og:description" content="LCZ4r">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">LCZ4r</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html" aria-label="Home">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/tutorials.html">Tutorials</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/examples.html">LCZ4r-QGIS Plugin</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ByMaxAnjos/LCZ4r/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Thermal Anomalies</h1>
                        <h4 data-toc-skip class="author">Max Anjos</h4>
            
            <h4 data-toc-skip class="date">March 15, 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ByMaxAnjos/LCZ4r/blob/HEAD/vignettes/local_func_anomaly.Rmd" class="external-link"><code>vignettes/local_func_anomaly.Rmd</code></a></small>
      <div class="d-none name"><code>local_func_anomaly.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>The thermal anomaly is a great way to evaluate the intra-urban air
temperatures differences. At each LCZ station, the thermal anomaly is
defined as the difference between its temperature and the overall mean
temperature of all LCZ stations. For instance, a positive temperature
anomaly indicates that a particular LCZ is warmer compared to all other
LCZs.</p>
<p>The <code><a href="../reference/lcz_anomaly.html">lcz_anomaly()</a></code> function has the same utilities as the
<code><a href="../reference/lcz_ts.html">lcz_ts()</a></code> regarding <strong>Flexibility of time
selection</strong> and <strong>Splitting LCZ time series by temporal
window or site</strong>.</p>
</div>
<div class="section level2">
<h2 id="plotting-options-with-plot_type">Plotting Options with plot_type<a class="anchor" aria-label="anchor" href="#plotting-options-with-plot_type"></a>
</h2>
<p>The plot_type argument in lcz_anomaly() offers several
visualizations:</p>
<ul>
<li>
<em>“diverging_bar”</em>: A horizontal bar plot that diverges from
the center (zero), with positive anomalies extending to the right and
negative anomalies to the left.</li>
<li>
<em>“bar”</em>: A bar plot showing the magnitude of the anomaly for
each station, colored by whether the anomaly is positive or
negative.</li>
<li>
<em>“dot”</em>: A dot plot that displays both the mean temperature
values and the reference values, with lines connecting them. The size or
color of the dots can indicate the magnitude of the anomaly</li>
<li>
<em>“lollipop”</em>: A lollipop plot where each “stick” represents
an anomaly value and the dots at the top represent the size of the
anomaly. Below are examples using each plot type.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the LCZ map for your city</span></span>
<span><span class="va">lcz_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lcz_get_map_euro.html">lcz_get_map_euro</a></span><span class="op">(</span>city<span class="op">=</span><span class="st">"Berlin"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load sample data from LCZ4r</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lcz_data"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="diverging-bar-plot">1. Diverging bar Plot<a class="anchor" aria-label="anchor" href="#diverging-bar-plot"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If you want the thermal anomalies for on 6th Feb 2019 at 05:00h</span></span>
<span><span class="fu"><a href="../reference/lcz_anomaly.html">lcz_anomaly</a></span><span class="op">(</span><span class="va">lcz_map</span>, </span>
<span>            data_frame <span class="op">=</span> <span class="va">lcz_data</span>, </span>
<span>            var <span class="op">=</span> <span class="st">"airT"</span>, </span>
<span>            station_id <span class="op">=</span> <span class="st">"station"</span>, </span>
<span>            time.freq <span class="op">=</span> <span class="st">"hour"</span>, </span>
<span>            year <span class="op">=</span> <span class="fl">2019</span>, month <span class="op">=</span> <span class="fl">2</span>, day <span class="op">=</span> <span class="fl">6</span>, hour<span class="op">=</span><span class="fl">5</span>,</span>
<span>            plot_type <span class="op">=</span> <span class="st">"diverging_bar"</span>,</span>
<span>            ylab <span class="op">=</span> <span class="st">"Air temperature [ºC]"</span>,</span>
<span>            xlab <span class="op">=</span> <span class="st">"Stations"</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"LCZ-thermal Anomalies"</span>,</span>
<span>            caption <span class="op">=</span> <span class="st">"Source: LCZ4r, 2024"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fig_local_anomaly_1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="bar-plot">2. Bar plot<a class="anchor" aria-label="anchor" href="#bar-plot"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bar plot for on 6th Feb 2019 at 05:00h</span></span>
<span><span class="fu"><a href="../reference/lcz_anomaly.html">lcz_anomaly</a></span><span class="op">(</span><span class="va">lcz_map</span>, </span>
<span>            data_frame <span class="op">=</span> <span class="va">lcz_data</span>, </span>
<span>            var <span class="op">=</span> <span class="st">"airT"</span>, </span>
<span>            station_id <span class="op">=</span> <span class="st">"station"</span>, </span>
<span>            time.freq <span class="op">=</span> <span class="st">"hour"</span>, </span>
<span>            year <span class="op">=</span> <span class="fl">2019</span>, month <span class="op">=</span> <span class="fl">2</span>, day <span class="op">=</span> <span class="fl">6</span>, hour<span class="op">=</span><span class="fl">5</span>,</span>
<span>            plot_type <span class="op">=</span> <span class="st">"bar"</span></span>
<span>           <span class="op">)</span></span></code></pre></div>
<p><img src="fig_local_anomaly_2.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="dot-plot">3. Dot plot<a class="anchor" aria-label="anchor" href="#dot-plot"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Dot plot for on 6th Feb 2019 at 05:00h</span></span>
<span><span class="fu"><a href="../reference/lcz_anomaly.html">lcz_anomaly</a></span><span class="op">(</span><span class="va">lcz_map</span>, data_frame <span class="op">=</span> <span class="va">lcz_data</span>, var <span class="op">=</span> <span class="st">"airT"</span>, </span>
<span>            station_id <span class="op">=</span> <span class="st">"station"</span>, time.freq <span class="op">=</span> <span class="st">"hour"</span>, </span>
<span>            year <span class="op">=</span> <span class="fl">2019</span>, month <span class="op">=</span> <span class="fl">2</span>, day <span class="op">=</span> <span class="fl">6</span>, hour<span class="op">=</span><span class="fl">5</span>,</span>
<span>            plot_type <span class="op">=</span> <span class="st">"dot"</span></span>
<span>            <span class="op">)</span></span></code></pre></div>
<p><img src="fig_local_anomaly_3.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="lollipop-plot">4. Lollipop plot<a class="anchor" aria-label="anchor" href="#lollipop-plot"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Dot plot for on 6th Feb 2019 at 05:00h</span></span>
<span><span class="fu"><a href="../reference/lcz_anomaly.html">lcz_anomaly</a></span><span class="op">(</span><span class="va">lcz_map</span>, data_frame <span class="op">=</span> <span class="va">lcz_data</span>, var <span class="op">=</span> <span class="st">"airT"</span>, </span>
<span>            station_id <span class="op">=</span> <span class="st">"station"</span>, time.freq <span class="op">=</span> <span class="st">"hour"</span>, </span>
<span>            year <span class="op">=</span> <span class="fl">2019</span>, month <span class="op">=</span> <span class="fl">2</span>, day <span class="op">=</span> <span class="fl">6</span>, hour<span class="op">=</span><span class="fl">5</span>,</span>
<span>            plot_type <span class="op">=</span> <span class="st">"lollipop"</span></span>
<span>            <span class="op">)</span></span></code></pre></div>
<p><img src="fig_local_anomaly_4.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="splitting-anomalies-with-the-by-argument">Splitting Anomalies with the “by” argument<a class="anchor" aria-label="anchor" href="#splitting-anomalies-with-the-by-argument"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate anomalies for nighttime and daytime on 6th Feb 2019 </span></span>
<span><span class="fu"><a href="../reference/lcz_anomaly.html">lcz_anomaly</a></span><span class="op">(</span><span class="va">lcz_map</span>, data_frame <span class="op">=</span> <span class="va">lcz_data</span>, var <span class="op">=</span> <span class="st">"airT"</span>, </span>
<span>            station_id <span class="op">=</span> <span class="st">"station"</span>, time.freq <span class="op">=</span> <span class="st">"hour"</span>, </span>
<span>            year <span class="op">=</span> <span class="fl">2019</span>, month <span class="op">=</span> <span class="fl">2</span>, day <span class="op">=</span> <span class="fl">6</span>, </span>
<span>            plot_type <span class="op">=</span> <span class="st">"diverging_bar"</span>,</span>
<span>            by <span class="op">=</span> <span class="st">"daylight"</span></span>
<span>            <span class="op">)</span></span></code></pre></div>
<p><img src="fig_local_anomaly_5.png" width="100%" style="display: block; margin: auto;"></p>
<p>Combining daylight with months</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate monthly mean of anomalies for Feb and Oct 2019 </span></span>
<span><span class="fu"><a href="../reference/lcz_anomaly.html">lcz_anomaly</a></span><span class="op">(</span><span class="va">lcz_map</span>, data_frame <span class="op">=</span> <span class="va">lcz_data</span>, var <span class="op">=</span> <span class="st">"airT"</span>, </span>
<span>            station_id <span class="op">=</span> <span class="st">"station"</span>, time.freq <span class="op">=</span> <span class="st">"hour"</span>, </span>
<span>            year <span class="op">=</span> <span class="fl">2019</span>, month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">8</span><span class="op">)</span>, </span>
<span>            plot_type <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"daylight"</span>, <span class="st">"month"</span><span class="op">)</span></span>
<span>            <span class="op">)</span></span></code></pre></div>
<p><img src="fig_local_anomaly_6.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="return-a-dataframe-as-result">Return a dataframe as result<a class="anchor" aria-label="anchor" href="#return-a-dataframe-as-result"></a>
</h2>
<p>To save return in R, set iplot = FALSE and create an object.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Return daylight dataframe on 15th January of 2020</span></span>
<span><span class="va">my_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lcz_anomaly.html">lcz_anomaly</a></span><span class="op">(</span><span class="va">lcz_map</span>, data_frame <span class="op">=</span> <span class="va">lcz_data</span>, var <span class="op">=</span> <span class="st">"airT"</span>, </span>
<span>            station_id <span class="op">=</span> <span class="st">"station"</span>, time.freq <span class="op">=</span> <span class="st">"hour"</span>, </span>
<span>            year <span class="op">=</span> <span class="fl">2019</span>, month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">8</span><span class="op">)</span>, </span>
<span>            plot_type <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"daylight"</span>, <span class="st">"month"</span><span class="op">)</span>,</span>
<span>            iplot <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>            <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="have-feedback-or-suggestions">📬 Have feedback or suggestions?<a class="anchor" aria-label="anchor" href="#have-feedback-or-suggestions"></a>
</h2>
<p>We welcome your feedback and suggestions! If you have ideas for
improvements or spot any issues, please let us know. Click the button
below to submit a new issue on our GitHub repository.</p>
<button type="button" class="btn" style="background-color: #008000; color: white; padding: .25rem .5rem; font-size: .75rem; border: none; border-radius: .25rem;">
<a href="https://github.com/ByMaxAnjos/LCZ4r/issues/new" style="text-decoration: none; color: white;" class="external-link">
Open an issue in the Github repository </a>
</button>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Max Anjos.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
