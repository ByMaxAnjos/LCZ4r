---
title: "LCZ4r General Functions"
author: "Max Anjos"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
    html_document:
    toc: true
    toc_float: TRUE
    toc_depth: 2
    number_sections: false
    highlight: "textmate"
    css: custom.css
vignette: >
  %\VignetteIndexEntry{LCZ4r General Functions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r , include = FALSE}
knitr::knit_hooks$set(pngquant = knitr::hook_pngquant)
knitr::opts_chunk$set(
  message = FALSE,
  collapse = TRUE,
  comment = "#>",
  dev = "ragg_png",
  dpi = 72,
  fig.retina = 2,
  fig.width = 7,
  fig.height = 6,
  fig.align = "center",
  out.width = "100%",
  pngquant = "--speed=1 --quality=50"
)
```

The **`LCZ4r` general functions** are designed to facilitate the retrieval, analysis, and visualization of Local Climate Zones (LCZ) when LCZ related data is not readily available. They are engineered to get the LZ map, compute LCZ classes, and extract specific parameters of interest, including Sky View Factor (SVF), impervious surface fraction, and roughness element height, among others.

## Getting Started

The general functions, each serving a unique purpose:

| Function                | Description              | Data Required | Internet Access Required |
|------------------|------------------|-------------------|------------------|
| `lcz_get_map()`         | Obtain the LCZ map | Not needed | Yes  |
| `lcz_get_map2()`        | Obtain the LCZ map | Not needed | Not needed |
| `lcz_plot_map()`        | Visualize the LCZ map | Not needed | Not needed |
| `lcz_cal_area()`        | Calculate LCZ areas | Not needed | Not needed |
| `lcz_get_parameters()`  | Retrieve LCZ parameters | Not needed  | Not needed |
| `lcz_plot_parameters()` | Visualize LCZ parameters | Not needed | Not needed |

## Obtain an visualize the LCZ map

The `lcz_get_map()` function allows you to obtain the LCZ map for your city or a specific Region of Interest (ROI) using the global LCZ map developed by Demuzere et al. (2022). In our case, we used Rio de Janeiro, Brazil as reference. 


```{r echo=TRUE, fig.height=7, fig.width=11, message=FALSE, warning=FALSE}

library(LCZ4r)
# Get the LCZ map for your city
lcz_map <- lcz_get_map(city="Rio de Janeiro")

# Visualize the obtained LCZ map
lcz_plot_map(lcz_map, subtitle = "Rio de Janeiro")

```

Tips: *1*. In the rare cases when the `lcz_get_map()` function encounters inconsistencies (e.g., without internet), you can rely on the `lcz_get_map2()` as an alternative; *2*. Use `lcz_get_map()` function with the shp for ROI, coding lcz_get_map(roi="your_shp"). See the package [sf](https://r-spatial.github.io/sf/) to load the shp file into R.

## Calculate LCZ areas

This `lcz_cal_area()` function calculates the area for each LCZ classes, as follows:

```{r echo=TRUE, fig.height=7, fig.width=11, message=FALSE, warning=FALSE}
LCZarea <- lcz_cal_area(lcz_map)
LCZarea
```

Tips: this function provides a table.csv of the calculated LCZ areas, coding like this: *lcz_cal_area(lcz_map, iplot = FALSE)*

## Retrieve and visualize LCZ parameters

This `lcz_get_parameters()` function allows you to retrieve various LCZ parameters, including minimum, maximum, and mean values, sourced from Stewart and Oke (2012). These parameters can be converted into either shapefiles or raster stack, in which it is aggregated multiple rasters to unique file.

Here's a glimpse of the available LCZ parameters:

| Code | Parameter       | Description             | Unit  |
|------|-----------------|-------------------------|-------|
| SVF1 | Sky View Factor | Minimum Sky View Factor | [0-1] |
| SVF2 | Sky View Factor | Maximum Sky View Factor | [0-1] |
| SVF3 | Sky View Factor | Mean Sky View Factor | [0-1] |
| ASP1 | Aspect ratio | Minimum Aspect Ratio | [0-3] |
| ASP2 | Aspect ratio | Maximum Aspect Ratio | [0-3] |
| ASP3 | Aspect ratio | Mean Aspect Ratio | [0-3] |
| BUI1 | Building Surface Fraction | Minimum Building Surface Fraction | [%] |
| BUI2 | Building Surface Fraction | Maximum Building Surface Fraction | [%] |
| BUI3 | Building Surface Fraction | Mean Building Surface Fraction | [%] |
| IMP1 | Impervious Surface Fraction | Minimum Impervious Surface Fraction | [%] |
| IMP2 | Impervious Surface Fraction | Minimum Impervious Surface Fraction | [%] |
| IMP3 | Impervious Surface Fraction | Minimum Impervious Surface Fraction | [%] |
| VEG1 | Vegetation Surface Fraction | Minimum Vegetation Surface Fraction | [%] |
| VEG2 | Vegetation Surface Fraction | Maximum Vegetation Surface Fraction | [%] |
| VEG3 | Vegetation Surface Fraction | Mean Vegetation Surface Fraction | [%] |
| TRE1 | Tree Surface Fraction | Minimum Tree Surface Fraction | [%] |
| TRE2 | Tree Surface Fraction | Maximum Tree Surface Fraction | [%] |
| TRE3 | Tree Surface Fraction | Mean Tree Surface Fraction | [%] |
| HEI1 | Height Roughness Elements | Minimum Height Roughness Elements | [meters] |
| HEI2 | Height Roughness Elements | Maximum Height Roughness Elements | [meters] |
| HEI3 | Height Roughness Elements | Mean Height Roughness Elements | [meters] |
| TER1 | Terrain Roughness class | Minimum Terrain Roughness class | [meters] |
| TER2 | Terrain Roughness class | Maximum Terrain Roughness class | [meters] |
| TER3 | Terrain Roughness class | Mean Terrain Roughness class | [meters] |
| ADM1 | Surface Admittance | Minimum Surface Admittance | [J m-2 s1/2 K-1] |
| ADM2 | Surface Admittance | Maximum Surface Admittance | [J m-2 s1/2 K-1] |
| ADM3 | Surface Admittance | Mean Surface Admittance | [J m-2 s1/2 K-1] |
| ALB1 | Surface Albedo | Minimum Surface Albedo | [0-0.5] |
| ALB2 | Surface Albedo | Maximum Surface Albedo | [0-0.5] |
| ALB3 | Surface Albedo | Mean Surface Albedo | [0-0.5] |
| ANT1 | Anthropogenic Heat Outupt | Minimum Anthropogenic Heat Outupt | [W m-2] |
| ANT2 | Anthropogenic Heat Outupt | Maximum Anthropogenic Heat Outupt | [W m-2] |
| ANT3 | Anthropogenic Heat Outupt | Mean Anthropogenic Heat Outupt | [W m-2] |
| z0 | Roughness Lenght | Roughness Lenght class | [meters] |


```{r echo=TRUE, fig.height=7, fig.width=11, message=FALSE, warning=FALSE}

# Extract the LCZ parameters for raster stack format
LCZpar <- lcz_get_parameters(lcz_map, istack = TRUE)

# Visualize the selected parameter, using SVF3 code for Mean Sky View Factor values
lcz_plot_parameters(LCZpar, iselect = "SVF3", subtitle = "Rio de Janeiro")

```
